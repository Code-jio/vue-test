# ğŸŒ… HDRå¤©ç©ºç›’ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨EngineKernelå¼•æ“åˆ›å»ºHDRå¤©ç©ºç›’çš„åŸºç¡€ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å¤ç”¨`useEngine`ä»£ç æ¥åˆ›å»ºå…·æœ‰çœŸå®æ„Ÿå…‰ç…§çš„3Dåœºæ™¯ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½
- **HDRç¯å¢ƒè´´å›¾å¤©ç©ºç›’**ï¼šä½¿ç”¨`rustig_koppie_puresky_2k.hdr`æ–‡ä»¶
- **åŸºäºç‰©ç†çš„æ¸²æŸ“**ï¼šæ”¯æŒé‡‘å±åº¦å’Œç²—ç³™åº¦æè´¨
- **å®æ—¶æ›å…‰è°ƒèŠ‚**ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´HDRå¼ºåº¦
- **ç¯å¢ƒå…‰ç…§**ï¼šHDRè´´å›¾æä¾›çœŸå®çš„ç¯å¢ƒå…‰ç…§
- **æè´¨åå°„**ï¼šé‡‘å±æè´¨èƒ½å¤Ÿåå°„HDRç¯å¢ƒ
- **å¤ç”¨å¼•æ“ä»£ç **ï¼šå®Œå…¨åŸºäº`useEngine`ç»„åˆå¼API

### ğŸ® äº¤äº’æ§åˆ¶
- **é‡ç½®ç›¸æœº**ï¼šæ¢å¤åˆ°é»˜è®¤è§†è§’
- **æ·»åŠ æµ‹è¯•å¯¹è±¡**ï¼šåŠ¨æ€æ·»åŠ é«˜åå°„é‡‘å±çƒä½“
- **æ›å…‰è°ƒèŠ‚**ï¼šå®æ—¶è°ƒæ•´HDRå¼ºåº¦ï¼ˆ0.1x - 2.0xï¼‰
- **è½¨é“æ§åˆ¶**ï¼šé¼ æ ‡æ‹–æ‹½æ—‹è½¬ã€æ»šè½®ç¼©æ”¾

## ğŸ“ æ–‡ä»¶ç»“æ„

```
vue-test/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ HDRSkyTest.vue          # å®Œæ•´åŠŸèƒ½çš„HDRå¤©ç©ºç›’æµ‹è¯•é¡µé¢
â”‚   â”‚   â””â”€â”€ HDRSkyBasicExample.vue  # ç®€åŒ–çš„åŸºç¡€ç¤ºä¾‹
â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”œâ”€â”€ useEngine.js            # å¼•æ“æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â””â”€â”€ useDebug.js             # è°ƒè¯•æ—¥å¿—åŠŸèƒ½ï¼ˆå¤ç”¨ï¼‰
â”‚   â””â”€â”€ router/index.js             # è·¯ç”±é…ç½®
â”œâ”€â”€ public/
â”‚   â””â”€â”€ skybox/
â”‚       â”œâ”€â”€ rustig_koppie_puresky_2k.hdr  # 2K HDRå¤©ç©ºç›’æ–‡ä»¶
â”‚       â””â”€â”€ rustig_koppie_puresky_4k.hdr  # 4K HDRå¤©ç©ºç›’æ–‡ä»¶
â””â”€â”€ README-HDR-SkyBox.md           # æœ¬æ–‡æ¡£
```

## ğŸš€ æŠ€æœ¯å®ç°

### 1. å¼•æ“åˆå§‹åŒ–
```javascript
// å¤ç”¨useEngineçš„åˆå§‹åŒ–é€»è¾‘
await initializeEngine(addDebugLog)

// ç­‰å¾…å¼•æ“å°±ç»ª
await waitForEngineReady()
```

### 2. HDRå¤©ç©ºç›’æ’ä»¶æ³¨å†Œ
```javascript
engineInstance.register({
  name: 'HDRSkyBoxPlugin',
  path: '/plugins/webgl/skyBox',
  pluginClass: EngineKernel.SkyBox,
  userData: {
    scene: baseScenePlugin.scene,
    camera: baseScenePlugin.camera,
    renderer: baseScenePlugin.renderer,
    skyBoxType: EngineKernel.SkyBoxType.HDR_ENVIRONMENT,
    hdrMapPath: '/skybox/rustig_koppie_puresky_2k.hdr',
    hdrIntensity: 1.0,
    size: 50000
  }
})
```

### 3. æè´¨é…ç½®
```javascript
// é«˜åå°„é‡‘å±æè´¨ï¼Œå±•ç¤ºHDRç¯å¢ƒåå°„
const material = new THREE.MeshStandardMaterial({ 
  color: 0xffffff, 
  metalness: 0.9,    // é«˜é‡‘å±åº¦
  roughness: 0.1     // ä½ç²—ç³™åº¦ï¼ˆé«˜åå°„ï¼‰
})
```

### 4. æ›å…‰æ§åˆ¶
```javascript
// å®æ—¶è°ƒæ•´HDRæ›å…‰å¼ºåº¦
baseScenePlugin.renderer.toneMappingExposure = parseFloat(hdrIntensity.value)
```

## ğŸ¨ è®¾è®¡åŸåˆ™

### SOLIDåŸåˆ™éµå¾ª
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªå‡½æ•°åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **å¼€é—­åŸåˆ™**ï¼šé€šè¿‡æ’ä»¶ç³»ç»Ÿæ‰©å±•åŠŸèƒ½
3. **ä¾èµ–å€’ç½®**ï¼šä¾èµ–æŠ½è±¡çš„useEngineæ¥å£

### ä»£ç å¤ç”¨ç­–ç•¥
- **useEngineå¤ç”¨**ï¼šå®Œå…¨å¤ç”¨ç°æœ‰çš„å¼•æ“åˆå§‹åŒ–é€»è¾‘
- **useDebugå¤ç”¨**ï¼šå¤ç”¨è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ
- **æ’ä»¶åŒ–æ¶æ„**ï¼šHDRå¤©ç©ºç›’ä½œä¸ºç‹¬ç«‹æ’ä»¶

### é”™è¯¯å¤„ç†
- **å¼‚å¸¸æ•è·**ï¼šæ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½æœ‰try-catch
- **çŠ¶æ€æ£€æŸ¥**ï¼šæ“ä½œå‰æ£€æŸ¥å¼•æ“å°±ç»ªçŠ¶æ€
- **ç”¨æˆ·åé¦ˆ**ï¼šé€šè¿‡æ—¥å¿—ç³»ç»Ÿæä¾›è¯¦ç»†åé¦ˆ

## ğŸŒŸ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨é¡¹ç›®
```bash
cd vue-test
npm run dev
```

### 2. è®¿é—®ç¤ºä¾‹
- å®Œæ•´ç‰ˆï¼š`http://localhost:5173/hdr-sky-test`
- åŸºç¡€ç‰ˆï¼šéœ€è¦æ·»åŠ è·¯ç”±é…ç½®

### 3. æ“ä½œæŒ‡å—
1. ç­‰å¾…å¼•æ“åˆå§‹åŒ–å®Œæˆï¼ˆçŠ¶æ€ç‚¹å˜ç»¿ï¼‰
2. ç‚¹å‡»"é‡ç½®ç›¸æœº"è°ƒæ•´è§†è§’
3. ç‚¹å‡»"æ·»åŠ æµ‹è¯•å¯¹è±¡"åˆ›å»ºåå°„çƒä½“
4. æ‹–æ‹½"æ›å…‰å¼ºåº¦"æ»‘å—è°ƒèŠ‚HDRæ•ˆæœ
5. ä½¿ç”¨é¼ æ ‡æ‹–æ‹½æ—‹è½¬åœºæ™¯ï¼Œæ»šè½®ç¼©æ”¾

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### HDRæ–‡ä»¶æ ¼å¼
- **æ ¼å¼**ï¼šRGBE (.hdr)
- **æ˜ å°„**ï¼šç­‰è·æŸ±çŠ¶æŠ•å½± (EquirectangularReflectionMapping)
- **è‰²è°ƒæ˜ å°„**ï¼šACES Filmic Tone Mapping
- **ç”¨é€”**ï¼šç¯å¢ƒå…‰ç…§ + èƒŒæ™¯ + åå°„

### æ¸²æŸ“ç®¡çº¿
1. **HDRåŠ è½½**ï¼šRGBELoaderåŠ è½½.hdræ–‡ä»¶
2. **ç¯å¢ƒè®¾ç½®**ï¼šscene.background + scene.environment
3. **è‰²è°ƒæ˜ å°„**ï¼šrenderer.toneMapping + toneMappingExposure
4. **æè´¨å“åº”**ï¼šMeshStandardMaterialåŸºäºç‰©ç†æ¸²æŸ“

### æ€§èƒ½ä¼˜åŒ–
- **æ–‡ä»¶å¤§å°**ï¼šä¼˜å…ˆä½¿ç”¨2Kç‰ˆæœ¬ï¼ˆ3.9MB vs 15MBï¼‰
- **çº¹ç†ç¼“å­˜**ï¼šThree.jsè‡ªåŠ¨ç¼“å­˜å·²åŠ è½½çº¹ç†
- **æ¸²æŸ“ä¼˜åŒ–**ï¼šåˆç†çš„renderOrderè®¾ç½®

## ğŸ› å¸¸è§é—®é¢˜

### Q: HDRæ–‡ä»¶åŠ è½½å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œç½‘ç»œè¿æ¥ï¼Œç¡®ä¿HDRæ–‡ä»¶åœ¨public/skyboxç›®å½•ä¸‹

### Q: çœ‹ä¸åˆ°HDRæ•ˆæœï¼Ÿ
A: ç¡®ä¿ä½¿ç”¨MeshStandardMaterialï¼Œå¹¶è®¾ç½®åˆé€‚çš„metalnesså’Œroughnesså€¼

### Q: åœºæ™¯å¤ªæš—æˆ–å¤ªäº®ï¼Ÿ
A: è°ƒæ•´HDRå¼ºåº¦æ»‘å—ï¼Œæˆ–æ£€æŸ¥renderer.toneMappingExposureè®¾ç½®

### Q: å¼•æ“åˆå§‹åŒ–å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥EngineKernelæ˜¯å¦æ­£ç¡®åŠ è½½ï¼ŒæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

## ğŸ“š æ‰©å±•æ–¹å‘

### åŠŸèƒ½æ‰©å±•
- [ ] æ”¯æŒå¤šä¸ªHDRæ–‡ä»¶åˆ‡æ¢
- [ ] æ·»åŠ ç¨‹åºåŒ–å¤©ç©ºå¯¹æ¯”
- [ ] å®ç°æ—¥å¤œå¾ªç¯æ•ˆæœ
- [ ] æ·»åŠ åå¤„ç†æ•ˆæœ

### æ€§èƒ½ä¼˜åŒ–
- [ ] HDRæ–‡ä»¶é¢„åŠ è½½
- [ ] LODç³»ç»Ÿé›†æˆ
- [ ] æ¸²æŸ“æ€§èƒ½ç›‘æ§

### ç”¨æˆ·ä½“éªŒ
- [ ] æ‹–æ‹½ä¸Šä¼ HDRæ–‡ä»¶
- [ ] é¢„è®¾åœºæ™¯é…ç½®
- [ ] å¯¼å‡ºåœºæ™¯æˆªå›¾

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [EngineKernel SkyBoxæ’ä»¶æ–‡æ¡£](../../EngineKernel/docs/README-skybox.md)
- [Three.js HDRæ–‡æ¡£](https://threejs.org/docs/#examples/en/loaders/RGBELoader)
- [useEngineç»„åˆå¼APIæ–‡æ¡£](./src/composables/README.md)

---

**ä½œè€…**: EngineKernelå›¢é˜Ÿ  
**æ›´æ–°æ—¶é—´**: 2024å¹´  
**ç‰ˆæœ¬**: v1.0.0 