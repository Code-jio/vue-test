# Three.js 力引导关系图

## 概述

这是一个使用 Three.js 模仿 ECharts 力引导关系图的实现。它展示了球体节点之间的关系，并通过物理力模拟来布局节点。

## 功能特性

### 🌟 核心功能
- **3D 球体节点**：每个节点都是一个彩色的3D球体
- **连接线**：显示节点之间的关系
- **力引导布局**：
  - 节点之间存在互斥力（斥力）
  - 连接的节点之间存在引力
  - 阻尼效果防止过度震荡
  - 中心力防止节点飘得太远

### 🎮 交互功能
- **鼠标拖拽**：点击并拖拽任意球体
- **相机控制**：
  - 鼠标左键拖拽：旋转视角
  - 鼠标滚轮：缩放视图
  - 鼠标右键拖拽：平移视角

### 🎛️ 控制面板
- **节点数量**：调整图中节点的数量（5-50）
- **连接密度**：控制节点之间连接的密度（0.1-1.0）
- **斥力强度**：调整节点之间的排斥力（100-1000）
- **引力强度**：调整连接节点之间的吸引力（0.1-2.0）
- **动画控制**：暂停/开始物理模拟
- **位置重置**：重新随机分布所有节点

### 🎨 预设模式
1. **随机网络**：节点随机连接，颜色随机
2. **星形网络**：所有节点连接到中心节点
3. **聚类网络**：节点分成3个聚类，主要与同类连接
4. **社交网络**：基于重要性的连接模式
5. **层级网络**：三级层级结构，根节点→主节点→子节点

## 技术实现

### 层级网络结构
**三级层级关系**：
- **第一级（根节点）**：红色大球体，位于中心，连接所有第二级节点
- **第二级（主节点）**：绿色中等球体，围绕根节点分布，连接第三级节点
- **第三级（子节点）**：蓝色小球体，围绕对应的第二级节点分布

**连接规则**：
- 根节点连接到所有主节点
- 主节点连接到分配给它的子节点
- 同级节点之间不建立连接（纯层级结构）

**可视化特性**：
- 不同层级使用不同颜色和大小
- 智能初始位置：根节点居中，主节点环绕，子节点围绕对应主节点
- 连接线长度根据层级关系调整
- 重置位置时保持层级结构
- 纯层级结构：只有父子连接，无同级连接

### 物理模拟
```javascript
// 力的计算
- 斥力：F = k / r²（库仑定律）
- 引力：F = k * (r - r0)（弹簧力）
- 阻尼：v = v * damping
- 更新：position += velocity * dt
```

### 节点类
```javascript
class Node {
    position: Vector3    // 3D位置
    velocity: Vector3    // 速度
    force: Vector3      // 受力
    radius: number      // 半径
    color: Color       // 颜色
    fixed: boolean     // 是否固定
}
```

### 连接类
```javascript
class Link {
    source: Node       // 源节点
    target: Node       // 目标节点
    length: number     // 理想长度
    strength: number   // 连接强度
}
```

## 使用方法

### 1. 启动应用
```bash
cd vue-test
npm run dev
```

### 2. 访问页面
访问 `http://localhost:3000/graph` 查看力引导关系图

### 3. 操作步骤
1. 选择预设模式查看不同的网络结构
2. 调整参数观察力引导效果的变化
3. 拖拽球体体验交互效果
4. 使用相机控制查看不同角度

## 算法原理

### 力引导算法
力引导布局是一种基于物理模拟的图布局算法：

1. **初始化**：随机放置所有节点
2. **力计算**：
   - 计算所有节点对之间的斥力
   - 计算连接节点之间的引力
   - 添加中心力防止发散
3. **更新位置**：
   - 根据受力更新速度
   - 应用阻尼减少震荡
   - 更新节点位置
4. **重复**：持续迭代直到系统稳定

### 参数调优
- **斥力强度**：太小会导致节点重叠，太大会导致过度分散
- **引力强度**：影响连接节点之间的距离
- **阻尼系数**：控制系统收敛速度，通常设为0.8-0.95
- **时间步长**：影响模拟精度和稳定性

## 扩展功能

### 可以添加的功能
- 节点标签显示
- 不同类型的连接线样式
- 节点大小根据度数调整
- 动态添加/删除节点
- 导出图像功能
- 性能优化（LOD、八叉树等）
- 层级网络扩展：
  - 支持更多层级（4级、5级等）
  - 层级折叠/展开功能
  - 根据数据动态调整层级分布
  - 层级统计信息显示

### 自定义数据
可以通过修改 `generateGraphData` 方法来加载自定义的图数据：

```javascript
const customData = {
    nodes: [
        { id: 0, name: "节点A", group: 1 },
        { id: 1, name: "节点B", group: 2 },
        // ...
    ],
    links: [
        { source: 0, target: 1, weight: 1.0 },
        // ...
    ]
}
```

### 层级网络示例
```javascript
// 企业组织结构示例
const organizationData = {
    nodes: [
        { id: 0, name: "CEO", level: 1, radius: 1.0 },
        { id: 1, name: "CTO", level: 2, radius: 0.6 },
        { id: 2, name: "CFO", level: 2, radius: 0.6 },
        { id: 3, name: "开发经理", level: 3, radius: 0.3 },
        { id: 4, name: "测试经理", level: 3, radius: 0.3 },
        { id: 5, name: "财务经理", level: 3, radius: 0.3 },
        // ...
    ],
    links: [
        { source: 0, target: 1, type: "reports_to" },
        { source: 0, target: 2, type: "reports_to" },
        { source: 1, target: 3, type: "manages" },
        { source: 1, target: 4, type: "manages" },
        { source: 2, target: 5, type: "manages" },
        // ...
    ]
}
```

## 性能考虑

- 节点数量建议控制在50以内以保证流畅性
- 使用较低的几何体细分数（16x16）以提高性能
- 力计算的时间复杂度为O(n²)，大规模图需要优化
- 可以使用 Web Workers 进行后台计算

## 浏览器兼容性

- 现代浏览器（Chrome, Firefox, Safari, Edge）
- 需要 WebGL 支持
- 推荐使用最新版本浏览器以获得最佳性能 